# ÐœÐ°ÑÑ‚Ð½Ð¸Ðº
#
#  1. Ð¡Ñ‚ÐµÐ»Ð° Ð»ÐµÑ‚Ð¸Ñ‚ Ñ‚Ð¾ Ð² Ð¾Ð´Ð½Ñƒ ÑÑ‚Ð¾Ñ€Ð¾Ð½Ñƒ
#  2. Ñ‚Ð¾ Ð² Ð´Ñ€ÑƒÐ³ÑƒÐ³ÑƒÑŽ
#  Ð. ÐÐ°Ñ‡Ð°Ð»Ð¾ Ð´Ð²Ð¸Ð¶ÐµÐ½Ð¸Ñ Ð¼Ð¾Ð¶ÐµÑ‚ Ð±Ñ‹Ñ‚ÑŒ ÑÐ»ÐµÐ²Ð°,
#  Ð‘. Ð° Ð¼Ð¾Ð¶ÐµÑ‚ Ð¸ ÑÐ¿Ñ€Ð°Ð²Ð°.
#
# Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ Ð´Ð²Ð° Ð²Ð·Ð²Ð¾Ð´Ð° Ñ€Ð¾Ð±Ð¾Ñ‚Ð¾Ð²
#
green = Array.new(10,1)
red = Array.new(10,1)

# ÐžÐ¿Ñ€ÐµÐ´ÐµÐ»Ð¸Ñ‚ÑŒ Ð¼ÐµÑ‚Ð¾Ð´ ÑÑ‚Ñ€ÐµÐ»ÑŒÐ±Ñ‹
#
def shoot_at( target_arr, \
              l_name, l_health, l_count, \
              r_name, r_health, r_count,
              to_right )
  target = rand(0..9)
  shoot_bar(  l_name, l_health, l_count, \
              r_name, r_health, r_count,\
              to_right )
  if target_arr[ target ] != 0
    target_arr[target] = 0 
    puts "\n  ÐµÑÑ‚ÑŒ Ð¿Ð¾Ð¿Ð°Ð´Ð°Ð½Ð¸Ðµ Ð½Ð° Ð¿Ð¾Ð·Ð¸Ñ†Ð¸Ð¸ #{target} !"
  else
    puts "\n  Ð¿Ñ€Ð¾Ð¼Ð°Ñ…..."
  end
end
# ÐžÐ¿Ñ€ÐµÐ´ÐµÐ»Ð¸Ñ‚ÑŒ Ð¼ÐµÑ‚Ð¾Ð´ ÑÑ‡ÐµÑ‚Ð° Ð´ÐµÐ¹ÑÑ‚Ð²ÑƒÑŽÑ‰Ð¸Ñ… Ñ€Ð¾Ð±Ð¾Ñ‚Ð¾Ð²
#
def count(arr)
  return arr.count { |element| element != 0 } 
end

def missile
  # Ñ‚Ð¸Ð¿ ÑÐ½Ð°Ñ€ÑÐ´a
  missile = [ ">", "#","â˜ ","âš•ï¸","âœˆï¸","âž¡ï¸","â™‚ï¸","â™€ï¸","â˜€","â™¦","âœ‰","âœ","âœ’"\
              ,"âœ‚","âš’","â˜¢","â†—","âž¡","â†˜","â¬‡","â†™","â¬…","â†–","â†•","â†”","â†©"\
              ,"â†ª","âš›","ðŸ•‰","âœ¡","â˜¸","â˜¯","âœ","â˜¦","â˜ª","â˜®","â–¶","â—€","âœ–"\
              ,"â—»","â–ª","â–«","â˜ ï¸" ]
  return missile[ rand(1..missile.length) - 1 ]
end

def shoot_bar(l_name, l_health, l_count, \
              r_name, r_health, r_count, \
              to_right )
  # Ñ€Ð°ÑÑ‡ÐµÑ‚ Ð´Ð»Ð¸Ð½Ñ‹ Ð¿Ð¾Ð»Ñ Ð»ÐµÐ²Ñ‹Ñ…
  l_health = "100%"                       # Ð·Ð´Ð¾Ñ€Ð¾Ð²ÑŒÐµ
  l_position = l_name.to_s + " #{l_count.to_s}u " +\
                "#{l_health.to_s}h"
  # ... Ð¸ Ð¿Ñ€Ð°Ð²Ñ‹Ñ…
  r_health = "100%"                       # Ð·Ð´Ð¾Ñ€Ð¾Ð²ÑŒÐµ
  r_position = r_name.to_s + " #{r_count.to_s}u " +\
                "#{r_health.to_s}h"
  # Ñ€Ð°ÑÑ‡ÐµÑ‚ Ð´Ð¸ÑÑ‚Ð°Ð½Ñ†Ð¸Ð¸ ÑÑ‚Ñ€ÐµÐ»ÑŒÐ±Ñ‹
  distance = 80 - ( l_position.size + r_position.size )
  miss_ile = missile                      # Ñ‚Ð¸Ð¿ ÑÐ½Ð°Ñ€ÑÐ´Ð°

  # Ð¿Ð¾Ð»ÐµÑ‚ ÑÐ½Ð°Ñ€ÑÐ´Ð°
  1.upto(distance) do |i|
    fire = i                              # Ð¿Ð»Ð°Ð¼Ñ ÑÐ½Ð°Ñ€ÑÐ´Ð°
    air = distance - i + 2                # ÑÐ½Ð°Ñ€ÑÐ´ Ð½Ð° Ð´Ð²Ð° ÑÐ¸Ð¼Ð²Ð¾Ð»Ð°

    # Ð°Ñ‚Ð¾Ð¼ Ð´Ð²Ð¸Ð¶ÐµÐ½Ð¸Ñ, Ð·Ð°ÑÑ‚Ñ‹Ð²ÑˆÐµÐµ Ð¼Ð³Ð½Ð¾Ð²ÐµÐ½Ð¸Ðµ
    case to_right
    when true                             # ÑÐ¿Ñ€Ð°Ð²Ð° Ð½Ð° Ð»ÐµÐ²Ð¾ 
      print "#{l_position}" + \
            "="*i + "#{miss_ile}" + ">" + " "*air + \
            "#{r_position}" + "\r"
      sleep rand (0.05..0.09)               # Ñ‚Ñ€ÐµÐ½Ð¸Ðµ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ñ‡Ð¸Ð²Ð¾
    else
      print "#{l_position}" + \
          " "*air + "<" + "#{miss_ile}" + "="*i + \
          "#{r_position}" + "\r"
      sleep rand (0.05..0.09)               # Ñ‚Ñ€ÐµÐ½Ð¸Ðµ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ñ‡Ð¸Ð²Ð¾
    end
  end
end

# Ð’ÐµÑÑ‚Ð¸ Ð²Ð¾Ð¹Ð½Ñƒ
#
# Ð˜Ð´ÐµÐ°Ð»ÑŒÐ½Ñ‹Ð¹ Ð°Ð»Ð³Ð¾Ñ€Ð¸Ñ‚Ð¼
#
# 0. ÐžÐ¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ñ Ð¸Ð³Ñ€Ñ‹
# 0.1 Ð Ð°Ð·Ð¼ÐµÑ€ Ð²Ð·Ð²Ð¾Ð´Ð°, Ð¾Ð´Ð¸Ð½Ð°ÐºÐ¾Ð² Ð´Ð»Ñ ÐºÐ°Ð¶Ð´Ð¾Ð¹ Ð¸Ð· ÑÑ‚Ð¾Ñ€Ð¾Ð½
# 0.2 ÐÐ°Ð·Ð²Ð°Ð½Ð¸Ñ ÐºÐ¾Ð¼Ð°Ð½Ð´, Ð¸Ð½Ð´Ð¸Ð²Ð¸Ð´ÑƒÐ°Ð»ÑŒÐ½Ñ‹Ðµ
# 0.3 Ð—Ð´Ð¾Ñ€Ð¾Ð²ÑŒÐµ Ñ€Ð¾Ð±Ð¾Ñ‚Ð°: Ð±Ð¸Ñ‚Ñ‹ Ð¸Ð»Ð¸ Ð±Ð°Ð¹Ñ‚Ñ‹? 
#
# 1. Ð¶ÐµÑ€ÐµÐ±ÑŒÐµÐ²ÐºÐ° Ð¿ÐµÑ€Ð²Ð¾Ð³Ð¾ Ð²Ñ‹ÑÑ‚Ñ€ÐµÐ»Ð°
# 2. Ð²Ñ‹Ð·Ð¾Ð² Ð¿Ñ€Ð¾Ñ†ÐµÐ´ÑƒÑ€Ñ‹ 
# 2.1 Ð²Ñ‹ÑÑ‚Ñ€ÐµÐ»
# 2.2 Ð¿Ð¾Ð´ÑÑ‡ÐµÑ‚ Ð¿Ð¾Ñ‚ÐµÑ€ÑŒ
# 2.3 Ð²Ñ‹Ð²Ð¾Ð´ Ð¾ Ð¿Ð¾Ð±ÐµÐ´Ðµ
# 2.4 Ð¿ÐµÑ€ÐµÐ´Ð°Ñ‡Ð° Ñ…Ð¾Ð´Ð° Ð¿Ñ€Ð¾Ñ‚Ð¸Ð²Ð½Ð¸ÐºÑƒ, Ð¿. 2
#
#
loop do
  # ÐšÑ€Ð°ÑÐ½Ñ‹Ðµ ÑÐ»ÐµÐ²Ð°
  puts " "*28 + "ÐšÑ€Ð°ÑÐ½Ñ‹Ðµ Ð°Ñ‚Ð°ÐºÑƒÑŽÑ‚"
  shoot_at( green, \
              "ÐšÑ€Ð°ÑÐ½Ñ‹Ðµ", 1 , count(red) , \
              "Ð—ÐµÐ»ÐµÐ½Ñ‹Ðµ", 1 , count(green), \
              true )
  sleep rand(0.5..0.9)
  if  count(green) == 0 
    puts "-"*20 + "\n" + "ÐšÐ¾Ð½ÐµÑ† Ð·ÐµÐ»ÐµÐ½Ñ‹Ð¼!"
    exit
  else 
    # Ð—ÐµÐ»ÐµÐ½Ñ‹Ðµ ÑÐ¿Ñ€Ð°Ð²Ð°
    puts " "*28 + "Ð—ÐµÐ»Ñ‘Ð½Ñ‹Ðµ Ð°Ñ‚Ð°ÐºÑƒÑŽÑ‚"
    shoot_at( red, \
              "ÐšÑ€Ð°ÑÐ½Ñ‹Ðµ", 1 , count(red), \
              "Ð—ÐµÐ»Ñ‘Ð½Ñ‹Ðµ", 1 , count(green), \
              false )
    sleep rand(0.5..0.9)
      if count(red) == 0
        puts "-"*20 + "\n" + "ÐšÐ¾Ð½ÐµÑ† ÐºÑ€Ð°ÑÐ½Ñ‹Ð¼!"
        exit
      end
  end
end
